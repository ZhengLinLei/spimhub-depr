window.addEventListener("load",(function(){let e=document.getElementById("content-search-file");e.addEventListener("keyup",(e=>{13!==e.keyCode&&"Enter"!==e.key||(e.preventDefault(),document.getElementById("content-find-btn").click())}));document.getElementById("content-replace-file");let n=document.querySelector(".file-occurences-list");document.getElementById("content-find-btn").addEventListener("click",(()=>{if(""!=e.value){let t=find_files(e.value);document.querySelector(".file-occurences").innerHTML=`${t.length}`,n.innerHTML="",t.forEach((t=>{let l=document.createElement("li"),c=document.createElement("div");c.classList.add("level");let i=document.createElement("a");i.classList.add("level-file"),i.innerHTML=`[${t[0].name}]`,i.addEventListener("click",(()=>{open_file(t[0])}));let d=document.createElement("ul");t[1].forEach((n=>{let l=document.createElement("li"),c=document.createElement("a");c.classList.add("occurence-position");let i=t[0].content.indexOf("\n",n),o=t[0].content.lastIndexOf(" ",n),a=t[0].content.substring(o,-1==i?t[0].content.length:i);a=a.replace(e.value,`<span class="bg-warning">${e.value}</span>`),c.innerHTML=a,c.addEventListener("click",(()=>{open_file(t[0]),focus_occurence(t[0],n,e.value)})),l.appendChild(c),d.appendChild(l)})),c.appendChild(i),c.appendChild(d),l.appendChild(c),n.appendChild(l)}))}else document.querySelector(".file-occurences").innerHTML="0",n.innerHTML=""})),document.getElementById("content-replace-btn").addEventListener("click",(()=>{}))}));const find_files=(e,n="/")=>{let t=FILE_SYSTEM[n]?FILE_SYSTEM[n].folders:[],l=FILE_SYSTEM[n]?Object.values(FILE_SYSTEM[n].files):[],c=[];for(let n=0;n<l.length;n++){let t=getIndicesOf(e,l[n].content,!1);t.length>0&&c.push([l[n],t])}for(let l=0;l<t.length;l++){let i=`${n}${t[l]}/`;c=c.concat(find_files(e,i))}return c};function getIndicesOf(e,n,t){if(0==e.length)return[];return t||(n=n.toLowerCase(),e=e.toLowerCase()),[...n.matchAll(new RegExp(e,"gi"))].map((e=>e.index))}const focus_occurence=(e,n,t)=>{let l=WINDOW_EDITOR.files[`w${WINDOW_EDITOR.active}`].find((n=>n.route+n.name==e.route+e.name)),c=l.__f.querySelector("textarea");l&&(c.focus(),c.selectionStart=n,c.selectionEnd=n+t.length,focus_line(c))};